import{f as pe,_ as _e}from"./AppLayout.vue_vue_type_script_setup_true_lang-D7mBAXqa.js";import{d as fe}from"./index-C4J_hXM0.js";import{d as xe,f as B,g as O,i as j,j as R,c as p,a as s,u as e,h as ge,w as a,b as r,t as o,o as m,F as b,r as h,e as z,k as i,l as _,m as U,p as ye}from"./app-OF75rUUz.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Cc1lF4gz.js";import{_ as G,a as q,b as H,c as J,d as M}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DNc9ivHO.js";import{_ as Q,a as W}from"./DialogFooter.vue_vue_type_script_setup_true_lang-D0XQkOPe.js";import{_ as k,a as w,b as S,c as V,d as f}from"./SelectValue.vue_vue_type_script_setup_true_lang-BpShbIMu.js";import{_ as E}from"./Input.vue_vue_type_script_setup_true_lang-Bjfj6md0.js";import{_ as x}from"./Label.vue_vue_type_script_setup_true_lang-BmWOigOZ.js";import"./index-CUil1_x-.js";import"./VisuallyHidden-BURlodgK.js";import"./useForwardExpose-D4n8HPIR.js";import"./useForwardPropsEmits-KhecIsfM.js";import"./createLucideIcon-BGjZscKd.js";import"./check-DezRYl4u.js";import"./useFormControl-zvR2hr_z.js";const ce={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},be={class:"grid auto-rows-min gap-4 md:grid-cols-4"},ve={class:"relative overflow-hidden rounded-xl border border-sidebar-border/70 p-6 dark:border-sidebar-border"},ke={class:"text-2xl font-bold"},we={class:"relative overflow-hidden rounded-xl border border-sidebar-border/70 p-6 dark:border-sidebar-border"},Se={class:"text-2xl font-bold"},Ve={class:"relative overflow-hidden rounded-xl border border-sidebar-border/70 p-6 dark:border-sidebar-border"},he={class:"text-2xl font-bold"},Pe={class:"relative overflow-hidden rounded-xl border border-sidebar-border/70 p-6 dark:border-sidebar-border"},Ce={class:"text-2xl font-bold text-green-600 dark:text-green-400"},Fe={class:"relative min-h-[100vh] flex-1 rounded-xl border border-sidebar-border/70 bg-white md:min-h-min dark:border-sidebar-border dark:bg-sidebar"},$e={class:"p-6"},De={class:"overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-200"},Ee={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-sidebar"},Ae={class:"whitespace-nowrap px-6 py-4 text-sm font-medium"},Ne={class:"whitespace-nowrap px-6 py-4 text-sm"},Ie={class:"whitespace-nowrap px-6 py-4 text-sm"},Te={class:"whitespace-nowrap px-6 py-4 text-sm font-semibold"},Be={class:"whitespace-nowrap px-6 py-4 text-sm"},Ke={key:0,class:"font-semibold text-orange-600 dark:text-orange-400"},Le={key:1,class:"font-semibold text-green-600 dark:text-green-400"},Oe={class:"whitespace-nowrap px-6 py-4 text-sm"},je={class:"whitespace-nowrap px-6 py-4 text-sm"},Re={class:"whitespace-nowrap px-6 py-4 text-right"},ze={class:"flex items-center justify-end gap-2"},Ge={class:"grid gap-4 py-4"},qe={class:"grid gap-2"},He={key:0,class:"text-sm text-red-600"},Je={key:1,class:"rounded-lg bg-green-50 p-3 dark:bg-green-900/20"},Me={class:"text-sm font-medium text-green-800 dark:text-green-200"},Qe={class:"grid gap-2"},We={key:0,class:"text-xs text-muted-foreground"},Xe={key:1,class:"text-sm text-red-600"},Ye={class:"grid gap-4 sm:grid-cols-2"},Ze={class:"grid gap-2"},et={key:0,class:"text-sm text-red-600"},tt={class:"grid gap-2"},dt={key:0,class:"text-sm text-red-600"},st={class:"grid gap-2"},at={key:0,class:"text-sm text-red-600"},rt={class:"grid gap-4 py-4"},ot={class:"grid gap-2"},nt={key:0,class:"text-sm text-red-600"},lt={key:1,class:"rounded-lg bg-green-50 p-3 dark:bg-green-900/20"},it={class:"text-sm font-medium text-green-800 dark:text-green-200"},ut={class:"grid gap-2"},mt={key:0,class:"text-xs text-muted-foreground"},pt={key:1,class:"text-sm text-red-600"},_t={class:"grid gap-4 sm:grid-cols-2"},ft={class:"grid gap-2"},xt={key:0,class:"text-sm text-red-600"},gt={class:"grid gap-2"},yt={key:0,class:"text-sm text-red-600"},ct={class:"grid gap-2"},bt={key:0,class:"text-sm text-red-600"},Tt=xe({__name:"Index",props:{payments:{},students:{},fees:{},credits:{}},setup(X){const P=X,y=P.payments||[],C=P.students||[],c=P.fees||[],K=P.credits||{},F=B(!1),$=B(!1),A=B(null),Y=[{title:"Dashboard",href:fe().url},{title:"Fee Payments",href:pe.index.url}],l=O({student_id:"",fee_id:"",amount_paid:"",payment_date:new Date().toISOString().split("T")[0],status:"pending"}),n=O({student_id:"",fee_id:"",amount_paid:"",payment_date:"",status:""}),N=()=>{l.reset(),l.payment_date=new Date().toISOString().split("T")[0]},L=()=>{n.reset()},Z=()=>{N(),F.value=!0},ee=()=>{l.post("/fee-payments",{onSuccess:()=>{F.value=!1,N()}})},te=u=>{const t=y.find(d=>d.id===u);t&&(A.value=t.id,n.student_id=t.student_id.toString(),n.fee_id=t.fee_id.toString(),n.amount_paid=t.amount_paid.toString(),n.payment_date=t.payment_date,n.status=t.status,$.value=!0)},de=()=>{A.value&&n.put(`/fee-payments/${A.value}`,{onSuccess:()=>{$.value=!1,L()}})},se=u=>{confirm("Are you sure you want to delete this payment?")&&ye.delete(`/fee-payments/${u}`)},g=u=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(u),ae=u=>u?new Date(u).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}):"Not paid",re=u=>{const t={paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",partial:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",pending:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"};return t[u]||t.pending},oe=y.reduce((u,t)=>u+parseFloat(t.amount_paid||0),0),ne=y.filter(u=>u.status==="paid").length,le=y.filter(u=>u.status==="pending").length,ie=j(()=>{if(!l.student_id)return c;const u=C.find(t=>t.id.toString()===l.student_id);return!u||!u.grade_id?c:c.filter(t=>t.grade_id===u.grade_id)}),ue=j(()=>{if(!n.student_id)return c;const u=C.find(t=>t.id.toString()===n.student_id);return!u||!u.grade_id?c:c.filter(t=>t.grade_id===u.grade_id)});R(()=>l.student_id,()=>{l.fee_id=""}),R(()=>n.student_id,()=>{n.fee_id=""});const D=u=>(K[u]||[]).reduce((I,T)=>I+parseFloat(T.amount||0),0),me=Object.values(K).flat().reduce((u,t)=>u+parseFloat(t.amount||0),0);return(u,t)=>(m(),p(b,null,[s(e(ge),{title:"Fee Payments"}),s(_e,{breadcrumbs:Y},{default:a(()=>[r("div",ce,[r("div",be,[r("div",ve,[t[16]||(t[16]=r("div",{class:"text-sm font-medium text-muted-foreground"},"Total Payments",-1)),r("div",ke,o(e(y).length),1)]),r("div",we,[t[17]||(t[17]=r("div",{class:"text-sm font-medium text-muted-foreground"},"Total Collected",-1)),r("div",Se,o(g(e(oe))),1)]),r("div",Ve,[t[18]||(t[18]=r("div",{class:"text-sm font-medium text-muted-foreground"},"Paid / Pending",-1)),r("div",he,o(e(ne))+" / "+o(e(le)),1)]),r("div",Pe,[t[19]||(t[19]=r("div",{class:"text-sm font-medium text-muted-foreground"},"Available Credits",-1)),r("div",Ce,o(g(e(me))),1)])]),r("div",Fe,[r("div",$e,[r("div",{class:"mb-4 flex items-center justify-between"},[t[20]||(t[20]=r("h2",{class:"text-xl font-semibold"},"Fee Payments",-1)),r("button",{onClick:Z,class:"rounded-lg bg-black px-4 py-2 text-sm font-medium text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200"}," + Record Payment ")]),r("div",De,[r("table",Ue,[t[23]||(t[23]=r("thead",{class:"bg-gray-50 dark:bg-sidebar-accent"},[r("tr",null,[r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Student"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Grade"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Term"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Amount Paid"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Balance"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Payment Date"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Status"),r("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Actions")])],-1)),r("tbody",Ee,[(m(!0),p(b,null,h(e(y),(d,I)=>(m(),p("tr",{key:d.id,class:z(["hover:bg-gray-50 dark:hover:bg-sidebar-accent",{"bg-muted/50":I%2===0}])},[r("td",Ae,o(d.student?.first_name)+" "+o(d.student?.last_name),1),r("td",Ne,o(d.fee?.grade?.name||"N/A"),1),r("td",Ie,o(d.fee?.term||"N/A"),1),r("td",Te,o(g(d.amount_paid)),1),r("td",Be,[d.balance>0?(m(),p("span",Ke,o(g(d.balance)),1)):(m(),p("span",Le," Paid "))]),r("td",Oe,o(ae(d.payment_date)),1),r("td",je,[r("span",{class:z([re(d.status),"rounded-full px-2 py-1 text-xs font-medium uppercase"])},o(d.status),3)]),r("td",Re,[r("div",ze,[s(e(v),{variant:"ghost",size:"sm",onClick:T=>te(d.id)},{default:a(()=>[...t[21]||(t[21]=[i(" Edit ",-1)])]),_:1},8,["onClick"]),s(e(v),{variant:"destructive",size:"sm",onClick:T=>se(d.id)},{default:a(()=>[...t[22]||(t[22]=[i(" Delete ",-1)])]),_:1},8,["onClick"])])])],2))),128))])])])])])]),s(e(G),{open:F.value,"onUpdate:open":t[7]||(t[7]=d=>F.value=d)},{default:a(()=>[s(e(q),{class:"sm:max-w-2xl",onInteractOutside:t[5]||(t[5]=d=>d.preventDefault()),onEscapeKeyDown:t[6]||(t[6]=d=>d.preventDefault())},{default:a(()=>[s(e(H),null,{default:a(()=>[s(e(J),null,{default:a(()=>[...t[24]||(t[24]=[i("Record New Payment",-1)])]),_:1}),s(e(M),null,{default:a(()=>[...t[25]||(t[25]=[i(" Enter the payment details below to record a new fee payment. ",-1)])]),_:1})]),_:1}),r("div",Ge,[r("div",qe,[s(e(x),{for:"student_id"},{default:a(()=>[...t[26]||(t[26]=[i("Student",-1)])]),_:1}),s(e(k),{modelValue:e(l).student_id,"onUpdate:modelValue":t[0]||(t[0]=d=>e(l).student_id=d)},{default:a(()=>[s(e(w),null,{default:a(()=>[s(e(S),{placeholder:"Select a student"})]),_:1}),s(e(V),null,{default:a(()=>[(m(!0),p(b,null,h(e(C),d=>(m(),U(e(f),{key:d.id,value:d.id.toString()},{default:a(()=>[i(o(d.first_name)+" "+o(d.last_name)+" - "+o(d.adm_no)+" ("+o(d.grade?.name)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(l).errors.student_id?(m(),p("span",He,o(e(l).errors.student_id),1)):_("",!0),e(l).student_id&&D(e(l).student_id)>0?(m(),p("div",Je,[r("p",Me," ðŸ’° Available Credit: "+o(g(D(e(l).student_id))),1),t[27]||(t[27]=r("p",{class:"text-xs text-green-600 dark:text-green-400"}," This credit can be applied to future fees ",-1))])):_("",!0)]),r("div",Qe,[s(e(x),{for:"fee_id"},{default:a(()=>[...t[28]||(t[28]=[i("Fee",-1)])]),_:1}),s(e(k),{modelValue:e(l).fee_id,"onUpdate:modelValue":t[1]||(t[1]=d=>e(l).fee_id=d),disabled:!e(l).student_id},{default:a(()=>[s(e(w),null,{default:a(()=>[s(e(S),{placeholder:"Select a fee"})]),_:1}),s(e(V),null,{default:a(()=>[(m(!0),p(b,null,h(ie.value,d=>(m(),U(e(f),{key:d.id,value:d.id.toString()},{default:a(()=>[i(o(d.term)+" ("+o(g(d.amount))+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),e(l).student_id?_("",!0):(m(),p("span",We,"Select a student first")),e(l).errors.fee_id?(m(),p("span",Xe,o(e(l).errors.fee_id),1)):_("",!0)]),r("div",Ye,[r("div",Ze,[s(e(x),{for:"amount_paid"},{default:a(()=>[...t[29]||(t[29]=[i("Amount Paid",-1)])]),_:1}),s(e(E),{id:"amount_paid",modelValue:e(l).amount_paid,"onUpdate:modelValue":t[2]||(t[2]=d=>e(l).amount_paid=d),type:"number",step:"0.01",placeholder:"15000.00"},null,8,["modelValue"]),e(l).errors.amount_paid?(m(),p("span",et,o(e(l).errors.amount_paid),1)):_("",!0)]),r("div",tt,[s(e(x),{for:"payment_date"},{default:a(()=>[...t[30]||(t[30]=[i("Payment Date",-1)])]),_:1}),s(e(E),{id:"payment_date",modelValue:e(l).payment_date,"onUpdate:modelValue":t[3]||(t[3]=d=>e(l).payment_date=d),type:"date"},null,8,["modelValue"]),e(l).errors.payment_date?(m(),p("span",dt,o(e(l).errors.payment_date),1)):_("",!0)])]),r("div",st,[s(e(x),{for:"status"},{default:a(()=>[...t[31]||(t[31]=[i("Status",-1)])]),_:1}),s(e(k),{modelValue:e(l).status,"onUpdate:modelValue":t[4]||(t[4]=d=>e(l).status=d)},{default:a(()=>[s(e(w),null,{default:a(()=>[s(e(S),{placeholder:"Select status"})]),_:1}),s(e(V),null,{default:a(()=>[s(e(f),{value:"pending"},{default:a(()=>[...t[32]||(t[32]=[i("Pending",-1)])]),_:1}),s(e(f),{value:"partial"},{default:a(()=>[...t[33]||(t[33]=[i("Partial",-1)])]),_:1}),s(e(f),{value:"paid"},{default:a(()=>[...t[34]||(t[34]=[i("Paid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(l).errors.status?(m(),p("span",at,o(e(l).errors.status),1)):_("",!0)])]),s(e(Q),{class:"pt-4"},{default:a(()=>[s(e(W),{"as-child":""},{default:a(()=>[s(e(v),{variant:"outline",onClick:N},{default:a(()=>[...t[35]||(t[35]=[i(" Cancel ",-1)])]),_:1})]),_:1}),s(e(v),{onClick:ee,disabled:e(l).processing},{default:a(()=>[i(o(e(l).processing?"Recording...":"Record Payment"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(e(G),{open:$.value,"onUpdate:open":t[15]||(t[15]=d=>$.value=d)},{default:a(()=>[s(e(q),{class:"sm:max-w-2xl",onInteractOutside:t[13]||(t[13]=d=>d.preventDefault()),onEscapeKeyDown:t[14]||(t[14]=d=>d.preventDefault())},{default:a(()=>[s(e(H),null,{default:a(()=>[s(e(J),null,{default:a(()=>[...t[36]||(t[36]=[i("Edit Payment",-1)])]),_:1}),s(e(M),null,{default:a(()=>[...t[37]||(t[37]=[i(" Update the payment details below. ",-1)])]),_:1})]),_:1}),r("div",rt,[r("div",ot,[s(e(x),{for:"edit_student_id"},{default:a(()=>[...t[38]||(t[38]=[i("Student",-1)])]),_:1}),s(e(k),{modelValue:e(n).student_id,"onUpdate:modelValue":t[8]||(t[8]=d=>e(n).student_id=d)},{default:a(()=>[s(e(w),null,{default:a(()=>[s(e(S),{placeholder:"Select a student"})]),_:1}),s(e(V),null,{default:a(()=>[(m(!0),p(b,null,h(e(C),d=>(m(),U(e(f),{key:d.id,value:d.id.toString()},{default:a(()=>[i(o(d.first_name)+" "+o(d.last_name)+" - "+o(d.adm_no)+" ("+o(d.grade?.name)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(n).errors.student_id?(m(),p("span",nt,o(e(n).errors.student_id),1)):_("",!0),e(n).student_id&&D(e(n).student_id)>0?(m(),p("div",lt,[r("p",it," ðŸ’° Available Credit: "+o(g(D(e(n).student_id))),1)])):_("",!0)]),r("div",ut,[s(e(x),{for:"edit_fee_id"},{default:a(()=>[...t[39]||(t[39]=[i("Fee",-1)])]),_:1}),s(e(k),{modelValue:e(n).fee_id,"onUpdate:modelValue":t[9]||(t[9]=d=>e(n).fee_id=d),disabled:!e(n).student_id},{default:a(()=>[s(e(w),null,{default:a(()=>[s(e(S),{placeholder:"Select a fee"})]),_:1}),s(e(V),null,{default:a(()=>[(m(!0),p(b,null,h(ue.value,d=>(m(),U(e(f),{key:d.id,value:d.id.toString()},{default:a(()=>[i(o(d.term)+" ("+o(g(d.amount))+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),e(n).student_id?_("",!0):(m(),p("span",mt,"Select a student first")),e(n).errors.fee_id?(m(),p("span",pt,o(e(n).errors.fee_id),1)):_("",!0)]),r("div",_t,[r("div",ft,[s(e(x),{for:"edit_amount_paid"},{default:a(()=>[...t[40]||(t[40]=[i("Amount Paid",-1)])]),_:1}),s(e(E),{id:"edit_amount_paid",modelValue:e(n).amount_paid,"onUpdate:modelValue":t[10]||(t[10]=d=>e(n).amount_paid=d),type:"number",step:"0.01",placeholder:"15000.00"},null,8,["modelValue"]),e(n).errors.amount_paid?(m(),p("span",xt,o(e(n).errors.amount_paid),1)):_("",!0)]),r("div",gt,[s(e(x),{for:"edit_payment_date"},{default:a(()=>[...t[41]||(t[41]=[i("Payment Date",-1)])]),_:1}),s(e(E),{id:"edit_payment_date",modelValue:e(n).payment_date,"onUpdate:modelValue":t[11]||(t[11]=d=>e(n).payment_date=d),type:"date"},null,8,["modelValue"]),e(n).errors.payment_date?(m(),p("span",yt,o(e(n).errors.payment_date),1)):_("",!0)])]),r("div",ct,[s(e(x),{for:"edit_status"},{default:a(()=>[...t[42]||(t[42]=[i("Status",-1)])]),_:1}),s(e(k),{modelValue:e(n).status,"onUpdate:modelValue":t[12]||(t[12]=d=>e(n).status=d)},{default:a(()=>[s(e(w),null,{default:a(()=>[s(e(S),{placeholder:"Select status"})]),_:1}),s(e(V),null,{default:a(()=>[s(e(f),{value:"pending"},{default:a(()=>[...t[43]||(t[43]=[i("Pending",-1)])]),_:1}),s(e(f),{value:"partial"},{default:a(()=>[...t[44]||(t[44]=[i("Partial",-1)])]),_:1}),s(e(f),{value:"paid"},{default:a(()=>[...t[45]||(t[45]=[i("Paid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(n).errors.status?(m(),p("span",bt,o(e(n).errors.status),1)):_("",!0)])]),s(e(Q),{class:"pt-4"},{default:a(()=>[s(e(W),{"as-child":""},{default:a(()=>[s(e(v),{variant:"outline",onClick:L},{default:a(()=>[...t[46]||(t[46]=[i(" Cancel ",-1)])]),_:1})]),_:1}),s(e(v),{onClick:de,disabled:e(n).processing},{default:a(()=>[i(o(e(n).processing?"Updating...":"Update Payment"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{Tt as default};
