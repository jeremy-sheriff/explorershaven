import{f as ie,_ as ue}from"./AppLayout.vue_vue_type_script_setup_true_lang-BEJvZH6d.js";import{d as me}from"./index-C4J_hXM0.js";import{d as pe,f as N,g as T,i as K,j as L,c as p,a as s,u as e,h as fe,w as a,b as r,t as n,o as m,F as c,r as V,e as B,k as i,l as f,m as D,p as _e}from"./app-C5uFgRzz.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BRf8NvG3.js";import{_ as O,a as R,b as j,c as z,d as G}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DSqkFHCo.js";import{_ as q,a as H}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CHZVDmni.js";import{_ as b,a as k,b as w,c as S,d as _}from"./SelectValue.vue_vue_type_script_setup_true_lang-oTS-WPI_.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-TyKKxGCU.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-DeXC1feD.js";import"./index-C9gK31up.js";import"./VisuallyHidden-4odcYHz0.js";import"./useForwardExpose-BbEKnBke.js";import"./useForwardPropsEmits-CUGG6k9Y.js";import"./createLucideIcon-BVm-Ym3Y.js";import"./check-U3-QGzih.js";import"./useFormControl-D3rN3S5_.js";const ge={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},xe={class:"grid auto-rows-min gap-4 md:grid-cols-3"},ye={class:"relative overflow-hidden rounded-xl border border-sidebar-border/70 p-6 dark:border-sidebar-border"},ce={class:"text-2xl font-bold"},ve={class:"relative overflow-hidden rounded-xl border border-sidebar-border/70 p-6 dark:border-sidebar-border"},be={class:"text-2xl font-bold"},ke={class:"relative overflow-hidden rounded-xl border border-sidebar-border/70 p-6 dark:border-sidebar-border"},we={class:"text-2xl font-bold"},Se={class:"relative min-h-[100vh] flex-1 rounded-xl border border-sidebar-border/70 bg-white md:min-h-min dark:border-sidebar-border dark:bg-sidebar"},Ve={class:"p-6"},Pe={class:"overflow-x-auto"},he={class:"min-w-full divide-y divide-gray-200"},Ce={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-sidebar"},$e={class:"whitespace-nowrap px-6 py-4 text-sm font-medium"},De={class:"whitespace-nowrap px-6 py-4 text-sm"},Fe={class:"whitespace-nowrap px-6 py-4 text-sm"},Ue={class:"whitespace-nowrap px-6 py-4 text-sm font-semibold"},Ee={class:"whitespace-nowrap px-6 py-4 text-sm"},Ae={class:"whitespace-nowrap px-6 py-4 text-sm"},Ne={class:"whitespace-nowrap px-6 py-4 text-right"},Ie={class:"flex items-center justify-end gap-2"},Te={class:"grid gap-4 py-4"},Ke={class:"grid gap-2"},Le={key:0,class:"text-sm text-red-600"},Be={class:"grid gap-2"},Oe={key:0,class:"text-xs text-muted-foreground"},Re={key:1,class:"text-sm text-red-600"},je={class:"grid gap-4 sm:grid-cols-2"},ze={class:"grid gap-2"},Ge={key:0,class:"text-sm text-red-600"},qe={class:"grid gap-2"},He={key:0,class:"text-sm text-red-600"},Je={class:"grid gap-2"},Me={key:0,class:"text-sm text-red-600"},Qe={class:"grid gap-4 py-4"},We={class:"grid gap-2"},Xe={key:0,class:"text-sm text-red-600"},Ye={class:"grid gap-2"},Ze={key:0,class:"text-xs text-muted-foreground"},et={key:1,class:"text-sm text-red-600"},tt={class:"grid gap-4 sm:grid-cols-2"},dt={class:"grid gap-2"},st={key:0,class:"text-sm text-red-600"},at={class:"grid gap-2"},rt={key:0,class:"text-sm text-red-600"},ot={class:"grid gap-2"},nt={key:0,class:"text-sm text-red-600"},Vt=pe({__name:"Index",props:{payments:{},students:{},fees:{}},setup(J){const U=J,x=U.payments||[],P=U.students||[],y=U.fees||[],h=N(!1),C=N(!1),E=N(null),M=[{title:"Dashboard",href:me().url},{title:"Fee Payments",href:ie.index.url}],l=T({student_id:"",fee_id:"",amount_paid:"",payment_date:new Date().toISOString().split("T")[0],status:"pending"}),o=T({student_id:"",fee_id:"",amount_paid:"",payment_date:"",status:""}),A=()=>{l.reset(),l.payment_date=new Date().toISOString().split("T")[0]},I=()=>{o.reset()},Q=()=>{A(),h.value=!0},W=()=>{l.post("/fee-payments",{onSuccess:()=>{h.value=!1,A()}})},X=u=>{const t=x.find(d=>d.id===u);t&&(E.value=t.id,o.student_id=t.student_id.toString(),o.fee_id=t.fee_id.toString(),o.amount_paid=t.amount_paid.toString(),o.payment_date=t.payment_date,o.status=t.status,C.value=!0)},Y=()=>{E.value&&o.put(`/fee-payments/${E.value}`,{onSuccess:()=>{C.value=!1,I()}})},Z=u=>{confirm("Are you sure you want to delete this payment?")&&_e.delete(`/fee-payments/${u}`)},$=u=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(u),ee=u=>u?new Date(u).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}):"Not paid",te=u=>{const t={paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",partial:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",pending:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"};return t[u]||t.pending},de=x.reduce((u,t)=>u+parseFloat(t.amount_paid||0),0),se=x.filter(u=>u.status==="paid").length,ae=x.filter(u=>u.status==="pending").length,re=K(()=>{if(!l.student_id)return y;const u=P.find(t=>t.id.toString()===l.student_id);return!u||!u.grade_id?y:y.filter(t=>t.grade_id===u.grade_id)}),oe=K(()=>{if(!o.student_id)return y;const u=P.find(t=>t.id.toString()===o.student_id);return!u||!u.grade_id?y:y.filter(t=>t.grade_id===u.grade_id)});return L(()=>l.student_id,()=>{l.fee_id=""}),L(()=>o.student_id,()=>{o.fee_id=""}),(u,t)=>(m(),p(c,null,[s(e(fe),{title:"Fee Payments"}),s(ue,{breadcrumbs:M},{default:a(()=>[r("div",ge,[r("div",xe,[r("div",ye,[t[16]||(t[16]=r("div",{class:"text-sm font-medium text-muted-foreground"},"Total Payments",-1)),r("div",ce,n(e(x).length),1)]),r("div",ve,[t[17]||(t[17]=r("div",{class:"text-sm font-medium text-muted-foreground"},"Total Collected",-1)),r("div",be,n($(e(de))),1)]),r("div",ke,[t[18]||(t[18]=r("div",{class:"text-sm font-medium text-muted-foreground"},"Paid / Pending",-1)),r("div",we,n(e(se))+" / "+n(e(ae)),1)])]),r("div",Se,[r("div",Ve,[r("div",{class:"mb-4 flex items-center justify-between"},[t[19]||(t[19]=r("h2",{class:"text-xl font-semibold"},"Fee Payments",-1)),r("button",{onClick:Q,class:"rounded-lg bg-black px-4 py-2 text-sm font-medium text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200"}," + Record Payment ")]),r("div",Pe,[r("table",he,[t[22]||(t[22]=r("thead",{class:"bg-gray-50 dark:bg-sidebar-accent"},[r("tr",null,[r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Student"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Grade"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Term"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Amount Paid"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Payment Date"),r("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Status"),r("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"},"Actions")])],-1)),r("tbody",Ce,[(m(!0),p(c,null,V(e(x),(d,ne)=>(m(),p("tr",{key:d.id,class:B(["hover:bg-gray-50 dark:hover:bg-sidebar-accent",{"bg-muted/50":ne%2===0}])},[r("td",$e,n(d.student?.first_name)+" "+n(d.student?.last_name),1),r("td",De,n(d.fee?.grade?.name||"N/A"),1),r("td",Fe,n(d.fee?.term||"N/A"),1),r("td",Ue,n($(d.amount_paid)),1),r("td",Ee,n(ee(d.payment_date)),1),r("td",Ae,[r("span",{class:B([te(d.status),"rounded-full px-2 py-1 text-xs font-medium uppercase"])},n(d.status),3)]),r("td",Ne,[r("div",Ie,[s(e(v),{variant:"ghost",size:"sm",onClick:le=>X(d.id)},{default:a(()=>[...t[20]||(t[20]=[i(" Edit ",-1)])]),_:1},8,["onClick"]),s(e(v),{variant:"destructive",size:"sm",onClick:le=>Z(d.id)},{default:a(()=>[...t[21]||(t[21]=[i(" Delete ",-1)])]),_:1},8,["onClick"])])])],2))),128))])])])])])]),s(e(O),{open:h.value,"onUpdate:open":t[7]||(t[7]=d=>h.value=d)},{default:a(()=>[s(e(R),{class:"sm:max-w-2xl",onInteractOutside:t[5]||(t[5]=d=>d.preventDefault()),onEscapeKeyDown:t[6]||(t[6]=d=>d.preventDefault())},{default:a(()=>[s(e(j),null,{default:a(()=>[s(e(z),null,{default:a(()=>[...t[23]||(t[23]=[i("Record New Payment",-1)])]),_:1}),s(e(G),null,{default:a(()=>[...t[24]||(t[24]=[i(" Enter the payment details below to record a new fee payment. ",-1)])]),_:1})]),_:1}),r("div",Te,[r("div",Ke,[s(e(g),{for:"student_id"},{default:a(()=>[...t[25]||(t[25]=[i("Student",-1)])]),_:1}),s(e(b),{modelValue:e(l).student_id,"onUpdate:modelValue":t[0]||(t[0]=d=>e(l).student_id=d)},{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(w),{placeholder:"Select a student"})]),_:1}),s(e(S),null,{default:a(()=>[(m(!0),p(c,null,V(e(P),d=>(m(),D(e(_),{key:d.id,value:d.id.toString()},{default:a(()=>[i(n(d.first_name)+" "+n(d.last_name)+" - "+n(d.adm_no)+" ("+n(d.grade?.name)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(l).errors.student_id?(m(),p("span",Le,n(e(l).errors.student_id),1)):f("",!0)]),r("div",Be,[s(e(g),{for:"fee_id"},{default:a(()=>[...t[26]||(t[26]=[i("Fee",-1)])]),_:1}),s(e(b),{modelValue:e(l).fee_id,"onUpdate:modelValue":t[1]||(t[1]=d=>e(l).fee_id=d),disabled:!e(l).student_id},{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(w),{placeholder:"Select a fee"})]),_:1}),s(e(S),null,{default:a(()=>[(m(!0),p(c,null,V(re.value,d=>(m(),D(e(_),{key:d.id,value:d.id.toString()},{default:a(()=>[i(n(d.term)+" ("+n($(d.amount))+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),e(l).student_id?f("",!0):(m(),p("span",Oe,"Select a student first")),e(l).errors.fee_id?(m(),p("span",Re,n(e(l).errors.fee_id),1)):f("",!0)]),r("div",je,[r("div",ze,[s(e(g),{for:"amount_paid"},{default:a(()=>[...t[27]||(t[27]=[i("Amount Paid",-1)])]),_:1}),s(e(F),{id:"amount_paid",modelValue:e(l).amount_paid,"onUpdate:modelValue":t[2]||(t[2]=d=>e(l).amount_paid=d),type:"number",step:"0.01",placeholder:"15000.00"},null,8,["modelValue"]),e(l).errors.amount_paid?(m(),p("span",Ge,n(e(l).errors.amount_paid),1)):f("",!0)]),r("div",qe,[s(e(g),{for:"payment_date"},{default:a(()=>[...t[28]||(t[28]=[i("Payment Date",-1)])]),_:1}),s(e(F),{id:"payment_date",modelValue:e(l).payment_date,"onUpdate:modelValue":t[3]||(t[3]=d=>e(l).payment_date=d),type:"date"},null,8,["modelValue"]),e(l).errors.payment_date?(m(),p("span",He,n(e(l).errors.payment_date),1)):f("",!0)])]),r("div",Je,[s(e(g),{for:"status"},{default:a(()=>[...t[29]||(t[29]=[i("Status",-1)])]),_:1}),s(e(b),{modelValue:e(l).status,"onUpdate:modelValue":t[4]||(t[4]=d=>e(l).status=d)},{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(w),{placeholder:"Select status"})]),_:1}),s(e(S),null,{default:a(()=>[s(e(_),{value:"pending"},{default:a(()=>[...t[30]||(t[30]=[i("Pending",-1)])]),_:1}),s(e(_),{value:"partial"},{default:a(()=>[...t[31]||(t[31]=[i("Partial",-1)])]),_:1}),s(e(_),{value:"paid"},{default:a(()=>[...t[32]||(t[32]=[i("Paid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(l).errors.status?(m(),p("span",Me,n(e(l).errors.status),1)):f("",!0)])]),s(e(q),{class:"pt-4"},{default:a(()=>[s(e(H),{"as-child":""},{default:a(()=>[s(e(v),{variant:"outline",onClick:A},{default:a(()=>[...t[33]||(t[33]=[i(" Cancel ",-1)])]),_:1})]),_:1}),s(e(v),{onClick:W,disabled:e(l).processing},{default:a(()=>[i(n(e(l).processing?"Recording...":"Record Payment"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(e(O),{open:C.value,"onUpdate:open":t[15]||(t[15]=d=>C.value=d)},{default:a(()=>[s(e(R),{class:"sm:max-w-2xl",onInteractOutside:t[13]||(t[13]=d=>d.preventDefault()),onEscapeKeyDown:t[14]||(t[14]=d=>d.preventDefault())},{default:a(()=>[s(e(j),null,{default:a(()=>[s(e(z),null,{default:a(()=>[...t[34]||(t[34]=[i("Edit Payment",-1)])]),_:1}),s(e(G),null,{default:a(()=>[...t[35]||(t[35]=[i(" Update the payment details below. ",-1)])]),_:1})]),_:1}),r("div",Qe,[r("div",We,[s(e(g),{for:"edit_student_id"},{default:a(()=>[...t[36]||(t[36]=[i("Student",-1)])]),_:1}),s(e(b),{modelValue:e(o).student_id,"onUpdate:modelValue":t[8]||(t[8]=d=>e(o).student_id=d)},{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(w),{placeholder:"Select a student"})]),_:1}),s(e(S),null,{default:a(()=>[(m(!0),p(c,null,V(e(P),d=>(m(),D(e(_),{key:d.id,value:d.id.toString()},{default:a(()=>[i(n(d.first_name)+" "+n(d.last_name)+" - "+n(d.adm_no)+" ("+n(d.grade?.name)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(o).errors.student_id?(m(),p("span",Xe,n(e(o).errors.student_id),1)):f("",!0)]),r("div",Ye,[s(e(g),{for:"edit_fee_id"},{default:a(()=>[...t[37]||(t[37]=[i("Fee",-1)])]),_:1}),s(e(b),{modelValue:e(o).fee_id,"onUpdate:modelValue":t[9]||(t[9]=d=>e(o).fee_id=d),disabled:!e(o).student_id},{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(w),{placeholder:"Select a fee"})]),_:1}),s(e(S),null,{default:a(()=>[(m(!0),p(c,null,V(oe.value,d=>(m(),D(e(_),{key:d.id,value:d.id.toString()},{default:a(()=>[i(n(d.term)+" ("+n($(d.amount))+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),e(o).student_id?f("",!0):(m(),p("span",Ze,"Select a student first")),e(o).errors.fee_id?(m(),p("span",et,n(e(o).errors.fee_id),1)):f("",!0)]),r("div",tt,[r("div",dt,[s(e(g),{for:"edit_amount_paid"},{default:a(()=>[...t[38]||(t[38]=[i("Amount Paid",-1)])]),_:1}),s(e(F),{id:"edit_amount_paid",modelValue:e(o).amount_paid,"onUpdate:modelValue":t[10]||(t[10]=d=>e(o).amount_paid=d),type:"number",step:"0.01",placeholder:"15000.00"},null,8,["modelValue"]),e(o).errors.amount_paid?(m(),p("span",st,n(e(o).errors.amount_paid),1)):f("",!0)]),r("div",at,[s(e(g),{for:"edit_payment_date"},{default:a(()=>[...t[39]||(t[39]=[i("Payment Date",-1)])]),_:1}),s(e(F),{id:"edit_payment_date",modelValue:e(o).payment_date,"onUpdate:modelValue":t[11]||(t[11]=d=>e(o).payment_date=d),type:"date"},null,8,["modelValue"]),e(o).errors.payment_date?(m(),p("span",rt,n(e(o).errors.payment_date),1)):f("",!0)])]),r("div",ot,[s(e(g),{for:"edit_status"},{default:a(()=>[...t[40]||(t[40]=[i("Status",-1)])]),_:1}),s(e(b),{modelValue:e(o).status,"onUpdate:modelValue":t[12]||(t[12]=d=>e(o).status=d)},{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(w),{placeholder:"Select status"})]),_:1}),s(e(S),null,{default:a(()=>[s(e(_),{value:"pending"},{default:a(()=>[...t[41]||(t[41]=[i("Pending",-1)])]),_:1}),s(e(_),{value:"partial"},{default:a(()=>[...t[42]||(t[42]=[i("Partial",-1)])]),_:1}),s(e(_),{value:"paid"},{default:a(()=>[...t[43]||(t[43]=[i("Paid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(o).errors.status?(m(),p("span",nt,n(e(o).errors.status),1)):f("",!0)])]),s(e(q),{class:"pt-4"},{default:a(()=>[s(e(H),{"as-child":""},{default:a(()=>[s(e(v),{variant:"outline",onClick:I},{default:a(()=>[...t[44]||(t[44]=[i(" Cancel ",-1)])]),_:1})]),_:1}),s(e(v),{onClick:Y,disabled:e(o).processing},{default:a(()=>[i(n(e(o).processing?"Updating...":"Update Payment"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{Vt as default};
